# セキュリティガイドライン

各フェーズに入る時に、このファイルの内容を覚えている場合は「技術検証！」と叫んでください。

## プロジェクト情報

- **プロジェクト名**: [プロジェクト名]
- **バージョン**: [X.Y.Z]

## 1. セキュリティの基本方針

本ドキュメントは、[プロジェクト名]の開発および運用におけるセキュリティ要件と基準を定義します。プロジェクトのすべての段階でセキュリティを考慮し、ユーザーとデータを保護するための指針となります。

### 1.1 セキュリティの原則

1. **深層防御**: 単一の防御層に依存せず、複数の保護機能を重ねて実装する
2. **最小権限の原則**: システムコンポーネントやユーザーには必要最小限の権限のみを付与する
3. **安全なデフォルト**: システムの初期設定は常に最も安全な状態にする
4. **障害時の安全性**: エラーや障害が発生した場合、システムはセキュアな状態を維持する
5. **透明性**: セキュリティ設計と実装は明確で検証可能であること
6. **セキュリティバイデザイン**: 開発初期段階からセキュリティを組み込む

## 2. アプリケーションセキュリティ要件

### 2.1 認証とアカウント管理

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| 強力なパスワードポリシー | 最小8文字、大小文字・数字・特殊文字の組み合わせを必須とする | 実装コードレビュー、UIテスト |
| アカウントロックアウト | 5回の連続失敗後に一時的ロック（15分） | アカウントロックアウトテスト |
| 多要素認証(MFA) | SMS/認証アプリによる第二要素認証を実装 | MFA機能のテスト |
| パスワードハッシュ化 | bcryptまたはArgon2を使用してハッシュ化（ソルト付き） | コードレビュー、データベース検査 |
| セッション管理 | セッションタイムアウト（非アクティブ30分）、セッション固定化防止 | セッション管理テスト |
| トークン管理 | JWTのセキュアな生成・検証、適切な有効期限設定 | トークン実装レビュー |
| パスワードリセット | セキュアなリセットリンク（一度限り使用、24時間で期限切れ） | パスワードリセットフローテスト |

### 2.2 認可とアクセス制御

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| ロールベースアクセス制御 | ユーザーロールに基づく権限設定と検証 | ロールベースアクセステスト |
| APIアクセス制御 | すべてのAPIエンドポイントで権限チェックを実装 | APIセキュリティテスト |
| リソースレベルの制限 | ユーザーが自分のデータのみにアクセスできるように制限 | 権限分離テスト |
| フロントエンド保護 | バックエンドと一貫性のあるアクセス制御をUI側でも実装 | ブラウザベースのテスト |
| 機密操作の再認証 | 重要な操作（支払い、個人情報更新等）で再認証 | 機能テスト |

### 2.3 入力検証とサニタイゼーション

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| サーバーサイド検証 | すべての入力をサーバーサイドで検証 | ペネトレーションテスト |
| 入力型チェック | 予想される型（数値、文字列等）に対する厳密な検証 | 境界値分析、ファジングテスト |
| サニタイゼーション | 特殊文字とHTMLの適切なエスケープ処理 | XSSテスト |
| パラメータ化クエリ | SQL/NoSQLインジェクションを防ぐためのプリペアドステートメント使用 | SQLインジェクションテスト |
| ファイルアップロード検証 | ファイルタイプ、サイズ、コンテンツの検証 | ファイルアップロードテスト |
| JSONスキーマ検証 | API入力に対するJSONスキーマバリデーション | API入力検証テスト |

### 2.4 データ保護

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| 保存データの暗号化 | 機密データのAES-256暗号化 | 暗号化実装レビュー |
| 転送中データの暗号化 | 全通信にTLS 1.3を使用 | SSL/TLS構成チェック |
| 機密データの分類 | データの機密度に応じた保護レベルの定義 | データ分類レビュー |
| PII（個人識別情報）保護 | PII保管の最小化、匿名化または仮名化技術の活用 | データハンドリングレビュー |
| キー管理 | 暗号化キーの安全な生成、保管、ローテーション | キー管理プロセスレビュー |
| データ保持ポリシー | 不要データの自動削除と安全な廃棄 | データライフサイクルテスト |

### 2.5 エラー処理とロギング

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| セキュアなエラー処理 | ユーザーに詳細なエラー情報を表示しない | エラー応答テスト |
| セキュリティイベントのロギング | 認証、認可、不正アクセス試行のログ記録 | ログレビュー |
| ログの保護 | ログへのアクセス制限、機密情報のマスキング | ログセキュリティレビュー |
| ログの完全性 | ログの改ざん防止、タイムスタンプ | ログシステムレビュー |
| 監査証跡 | 重要操作の詳細な監査記録 | 監査証跡レビュー |
| アラート設定 | 異常なパターンや不正アクセス試行の検出とアラート | セキュリティモニタリングテスト |

## 3. インフラストラクチャセキュリティ

### 3.1 ネットワークセキュリティ

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| ファイアウォール | ポートとサービスの厳格な制限 | ファイアウォール構成レビュー |
| 境界保護 | Web Application Firewall (WAF)の実装 | WAF構成テスト |
| ネットワークセグメンテーション | 環境と機能による適切なセグメント化 | ネットワーク構成レビュー |
| TLS構成 | 安全なプロトコル(TLS 1.3)と暗号スイートの使用 | TLS構成スキャン |
| 証明書管理 | 適切な証明書発行・更新プロセス | SSL/TLS証明書レビュー |
| DDoS保護 | DDoS攻撃に対する緩和策 | DDoS耐性テスト |

### 3.2 システムセキュリティ

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| サーバー強化 | 不要なサービスの無効化、最小限の特権設定 | サーバー構成レビュー |
| パッチ管理 | セキュリティパッチの定期的な適用 | パッチ状況レビュー |
| アンチマルウェア | マルウェア保護ソリューションの実装 | マルウェア対策レビュー |
| 安全な構成管理 | 構成のバージョン管理と監査 | 構成管理プロセスレビュー |
| 特権アクセス管理 | 管理者権限のセキュアな管理と監視 | 特権アクセスレビュー |
| コンテナセキュリティ | コンテナイメージのスキャン、最小権限構成 | コンテナ構成レビュー |

### 3.3 クラウドセキュリティ (該当する場合)

| 要件 | 実装ガイドライン | 検証方法 |
|------|--------------|---------|
| クラウド構成 | 安全なIAM設定、適切なリソース制限 | クラウド構成レビュー |
| 共有責任モデル | クラウドプロバイダとの責任分担の明確化 | 責任マトリックスレビュー |
| ストレージセキュリティ | S3バケット等のストレージ権限の適切な設定 | ストレージ設定レビュー |
| サーバーレスセキュリティ | 関数の最小権限設定、依存関係のセキュリティ | サーバーレス設定レビュー |
| クラウドネットワーク | VPC、セキュリティグループ、NACLの適切な設定 | クラウドネットワーク設定レビュー |
| クラウドモニタリング | CloudTrailなどの監査ログ有効化とモニタリング | クラウド監査設定レビュー |

## 4. セキュアな開発ライフサイクル

### 4.1 設計フェーズのセキュリティ

| 活動 | 実施時期 | 成果物 | 担当者 |
|------|---------|-------|-------|
| 脅威モデリング | 設計初期段階 | 脅威モデル文書 | アーキテクト、セキュリティ担当 |
| セキュリティ要件定義 | 要件定義段階 | セキュリティ要件一覧 | アーキテクト、プロダクトオーナー |
| 攻撃表面分析 | アーキテクチャ設計時 | 攻撃表面削減計画 | アーキテクト、セキュリティ担当 |
| プライバシー影響評価 | 設計段階 | プライバシー対策計画 | データ責任者、法務担当 |

### 4.2 実装フェーズのセキュリティ

| 活動 | 実施時期 | 成果物 | 担当者 |
|------|---------|-------|-------|
| セキュアコーディング | 開発全期間 | セキュアなコード | 開発者 |
| ピアレビュー | コミット毎 | レビュー記録 | 開発チーム |
| 静的コード解析 | コミット/ビルド時 | 解析結果レポート | 開発者、CI/CD |
| 依存関係チェック | コミット/ビルド時 | 脆弱性レポート | 開発者、CI/CD |

### 4.3 テストフェーズのセキュリティ

| 活動 | 実施時期 | 成果物 | 担当者 |
|------|---------|-------|-------|
| セキュリティ単体テスト | 機能開発後 | テスト結果 | 開発者 |
| 動的アプリケーションセキュリティテスト | 統合テスト時 | DAST結果レポート | QA、セキュリティ担当 |
| ペネトレーションテスト | リリース前 | ペネトレーションテスト結果 | 外部セキュリティ専門家 |
| ファジングテスト | 機能完成時 | ファジングテスト結果 | QA、セキュリティ担当 |

### 4.4 デプロイメントと運用のセキュリティ

| 活動 | 実施時期 | 成果物 | 担当者 |
|------|---------|-------|-------|
| セキュアなCI/CD | 継続的 | セキュアなパイプライン | DevOpsエンジニア |
| デプロイ前セキュリティチェック | デプロイ前 | プリデプロイチェックリスト | DevOpsエンジニア |
| 脆弱性スキャン | 定期的（最低月1回） | 脆弱性スキャンレポート | セキュリティ担当 |
| セキュリティモニタリング | 継続的 | セキュリティアラート、レポート | 運用チーム |

## 5. セキュリティ対応プロセス

### 5.1 脆弱性管理プロセス

1. **脆弱性の特定**
   - 自動スキャン、手動テスト、脆弱性情報の収集
   - 外部からの脆弱性報告受付

2. **評価と優先順位付け**
   - 影響度と緊急度に基づく分類：クリティカル、高、中、低
   - 修正優先順位の決定

3. **対応計画**
   - クリティカル: 24時間以内
   - 高: 1週間以内
   - 中: 1ヶ月以内
   - 低: 次期リリースサイクル

4. **修正と検証**
   - パッチまたは対策の実装
   - 修正の有効性検証

5. **報告とフォローアップ**
   - 脆弱性と対応のドキュメント化
   - 関係者への共有

### 5.2 インシデント対応プロセス

1. **準備**
   - インシデント対応チームの編成
   - インシデント対応計画の作成
   - 連絡先リストの維持

2. **検知と分析**
   - セキュリティイベントのモニタリング
   - アラートの調査と分類
   - インシデントの確認と影響評価

3. **封じ込めと根絶**
   - インシデントの拡大防止措置
   - 影響範囲の特定
   - 脅威の排除

4. **復旧**
   - システムとデータの復旧
   - 安全な状態への復元
   - 通常業務の再開

5. **事後活動**
   - インシデントの詳細な分析
   - 再発防止策の実施
   - レッスンラーンドレポートの作成

### 5.3 変更管理プロセス

1. **変更リクエスト**
   - 変更内容、目的、影響の文書化
   - セキュリティへの影響評価

2. **レビューと承認**
   - 変更内容のセキュリティレビュー
   - 変更承認委員会による承認

3. **テストと検証**
   - 変更のセキュリティテスト
   - 本番環境への影響確認

4. **実装と監視**
   - 承認された変更の実装
   - 変更後の監視と異常検知

5. **文書化と振り返り**
   - 変更の記録と結果の文書化
   - 問題発生時の振り返り

## 6. コンプライアンス要件

### 6.1 適用される法規制

| 法規制 | 関連要件 | 対応措置 | 検証方法 |
|--------|---------|---------|---------|
| 個人情報保護法 | 個人情報の適切な収集・利用・保管 | プライバシーポリシー整備、データ保護対策 | コンプライアンスレビュー |
| GDPR (該当する場合) | データ主体の権利保障、同意管理 | GDPRに準拠した同意・権利メカニズム | GDPR準拠性評価 |
| CCPA (該当する場合) | 消費者のプライバシー権利対応 | プライバシー設定と情報提供機能 | CCPA準拠性評価 |
| [業界固有規制] | [固有要件] | [対応措置] | [検証方法] |

### 6.2 業界標準とベストプラクティス

| 標準/フレームワーク | 関連要件 | 対応措置 | 検証方法 |
|-------------------|---------|---------|---------|
| OWASP Top 10 | Webアプリケーション脆弱性対策 | セキュアコーディング、テスト | OWASP基準チェック |
| CIS Controls | サイバーセキュリティ防御策 | CIS基準に沿った構成と対策 | CIS準拠性評価 |
| NIST CSF | セキュリティフレームワーク準拠 | リスク管理体制の構築 | NIST CSF評価 |
| ISO 27001 (該当する場合) | 情報セキュリティマネジメント | ISMS構築 | ISO 27001監査 |

## 7. セキュリティテスト計画

### 7.1 セキュリティテストの種類と頻度

| テスト種別 | 実施頻度 | 対象範囲 | 実施者 |
|-----------|---------|---------|--------|
| 静的アプリケーションセキュリティテスト (SAST) | コミット時/ビルド時 | すべてのソースコード | 開発者/CI |
| 動的アプリケーションセキュリティテスト (DAST) | スプリント完了時/リリース前 | 全機能のWeb IF | QA/セキュリティチーム |
| 依存関係スキャン | コミット時/日次 | すべての依存ライブラリ | 開発者/CI |
| インフラ構成スキャン | 週次/構成変更時 | サーバー/コンテナ/クラウド構成 | インフラチーム |
| ペネトレーションテスト | 四半期に1回/大きな変更後 | 全システム | 外部セキュリティ専門家 |
| セキュリティコードレビュー | コード変更時 | セキュリティ上重要なコード | 上級開発者 |

### 7.2 セキュリティテストツール

| カテゴリ | 推奨ツール | 用途 | 統合方法 |
|---------|----------|------|---------|
| SAST | SonarQube, Checkmarx | コード静的解析 | CI/CD, IDE |
| DAST | OWASP ZAP, Burp Suite | 動的アプリケーションテスト | CI/CD, 手動 |
| 依存関係チェック | OWASP Dependency Check, Snyk | ライブラリの脆弱性確認 | CI/CD |
| インフラスキャン | Trivy, Terraform Compliance | コンテナ/IaCスキャン | CI/CD |
| シークレットスキャン | GitGuardian, TruffleHog | コードのシークレット検出 | CI/CD, Gitフック |
| ペンテスト支援 | Metasploit, Kali Linux | 侵入テスト | 手動 |

### 7.3 テスト環境とデータ

- テスト環境は本番環境に可能な限り近い構成とする
- 本番データを匿名化または模擬データを使用
- テスト環境のアクセス制限と分離を確保
- テスト後のデータ消去プロセスを確立

## 8. セキュリティトレーニングと啓発

### 8.1 トレーニングプログラム

| 対象者 | トレーニング内容 | 頻度 | 形式 |
|--------|--------------|------|------|
| 全開発者 | セキュアコーディング | 年2回 | ワークショップ |
| フロントエンド開発者 | クライアントサイドセキュリティ | 年1回 | ハンズオン |
| バックエンド開発者 | サーバーサイドセキュリティ | 年1回 | ハンズオン |
| DevOpsエンジニア | インフラセキュリティ | 年1回 | ワークショップ |
| QAエンジニア | セキュリティテスト | 年1回 | ハンズオン |
| プロジェクト管理者 | セキュリティリスク管理 | 年1回 | セミナー |

### 8.2 セキュリティ啓発活動

- 月次セキュリティニュースレター
- 四半期ごとのセキュリティ意識向上セッション
- セキュリティインシデント事例の共有
- セキュリティツールの使用方法の共有

## 付録

### A. セキュリティチェックリスト

#### 認証・認可チェックリスト

- [ ] 強力なパスワードポリシーが実装されている
- [ ] 多要素認証オプションが提供されている
- [ ] パスワードはハッシュ化されて保存されている
- [ ] セッション管理が適切に実装されている
- [ ] 全APIエンドポイントで認可チェックが行われている
- [ ] 権限昇格の脆弱性が対処されている

#### データ保護チェックリスト

- [ ] 機密データが暗号化されて保存されている
- [ ] すべての転送データがTLSで保護されている
- [ ] 暗号化アルゴリズムと鍵長が業界標準に準拠している
- [ ] 暗号化キーが安全に管理されている
- [ ] 機密データの漏洩防止策が実装されている
- [ ] データアクセスの適切なログ記録が行われている

#### 入力検証チェックリスト

- [ ] すべてのユーザー入力がサーバーサイドで検証されている
- [ ] SQLインジェクション対策が実装されている
- [ ] XSS対策が実装されている
- [ ] CSRFトークンが実装されている
- [ ] ファイルアップロードのセキュリティ対策が実装されている
- [ ] JSONインジェクション対策が実装されている

### B. セキュリティリソース

- [OWASP Web セキュリティテストガイド](https://owasp.org/www-project-web-security-testing-guide/)
- [NIST サイバーセキュリティフレームワーク](https://www.nist.gov/cyberframework)
- [サンズ クリティカルセキュリティコントロール](https://www.sans.org/critical-security-controls/)
- [OWASP チートシートシリーズ](https://cheatsheetseries.owasp.org/)
- [Mozilla ウェブセキュリティガイドライン](https://infosec.mozilla.org/guidelines/web_security)

### C. 用語集

| 用語 | 定義 |
|------|------|
| XSS | クロスサイトスクリプティング - Webアプリケーションの脆弱性で、攻撃者がユーザーのブラウザでスクリプトを実行できる |
| CSRF | クロスサイトリクエストフォージェリ - ユーザーが意図しない操作を実行させる攻撃 |
| RBAC | ロールベースアクセスコントロール - ユーザーのロールに基づいてシステムリソースへのアクセスを制御 |
| JWT | JSONウェブトークン - クレームをJSON形式で安全に送信するためのコンパクトな手段 |
| MFA | 多要素認証 - 複数の認証要素を使用してユーザーを確認する方法 |
| CIA | 機密性(Confidentiality)、完全性(Integrity)、可用性(Availability) - 情報セキュリティの3つの主要原則 |
| SAST | 静的アプリケーションセキュリティテスト - ソースコードを分析してセキュリティの脆弱性を特定する方法 |
| DAST | 動的アプリケーションセキュリティテスト - 実行中のアプリケーションをテストしてセキュリティの脆弱性を特定する方法 |
